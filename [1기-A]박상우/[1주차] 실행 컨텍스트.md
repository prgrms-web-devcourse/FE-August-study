# 실행 컨텍스트

모던 자바스크립트 Deep Dive라는 책으로 실행 컨텍스트를 공부하고 그 내용을 정리했습니다.

![img-01](https://user-images.githubusercontent.com/81365896/128695063-478f6b64-9492-4043-9c30-cad6d2d80667.png)

실행 컨텍스트는 코드를 관리하는 메커니즘입니다. 그런데 코드를 관리한다는 것은 무엇을 의미할까요?

![img-03](https://user-images.githubusercontent.com/81365896/128695069-242e0394-e2d5-40d6-a30c-3fcbff0b5921.png)

코드 관리는 실행 순서 관리와 식별자 관리로 나뉩니다. 여기서 식별자란 변수, 함수, 클래스 등의 이름을 말합니다.

![img-04](https://user-images.githubusercontent.com/81365896/128695075-ba1cf914-d8c2-48b3-88e5-92d817b4dce5.png)

실행 순서는 실행 컨텍스트 스택으로, 식별자는 렉시컬 환경으로 관리됩니다.

![img-06](https://user-images.githubusercontent.com/81365896/128695080-6b20fd05-6d17-4b52-8d5c-5d9dd7c80412.png)
![img-07](https://user-images.githubusercontent.com/81365896/128695086-992bde95-9189-441a-928e-f05e6d953f29.png)

코드 예시를 보기 전에 간단한 개념을 언급하겠습니다.  
소스코드는 전역 코드와 함수 코드로 이루어져 있으며, 노란색 박스가 함수코드이고 그 밖의 부분이 전역코드입니다.

![img-08](https://user-images.githubusercontent.com/81365896/128695096-7ed2043a-dec5-48e2-8818-3a38c84de089.png)

이러한 소스코드를 자바스크립트 엔진이 처리하는 것은 평가 단계와 실행 단계로 나뉩니다.

![img-09](https://user-images.githubusercontent.com/81365896/128695099-a0d6c449-8025-4f01-81d3-bad5e5960935.png)

그래서 전역 코드와 함수 코드에 각각 평가와 실행 단계가 있습니다.  
이때 중첩함수가 있다면 3번과 4번 과정이 한 번 더 발생합니다.

![img-10](https://user-images.githubusercontent.com/81365896/128695104-d1a8409b-000d-4bc2-9b9c-8840f256a970.png)

자바스크립트 엔진이 코드를 처리하는 과정에는 실행 컨텍스트 스택이 사용됩니다.

![img-11](https://user-images.githubusercontent.com/81365896/128695107-2686ddac-7bf8-4f04-9061-aaf66024e558.png)

빨간색 화살표로 표시된 부분은 전역 변수와 전역 함수의 선언입니다.  
자바스크립트 엔진이 이것들을 전역 실행 컨텍스트에 등록하고, 그것을 실행 컨텍스트 스택에 푸시합니다.

![img-12](https://user-images.githubusercontent.com/81365896/128695117-58d89b3c-2773-4654-a649-7906d56e8c9a.png)

이후 전역 코드 실행 과정에서는 전역 변수 a에 값이 할당되고 전역 함수 foo가 호출됩니다.

![img-13](https://user-images.githubusercontent.com/81365896/128695120-1b174eda-552c-4356-99dc-003b20fb577f.png)

이전 단계에서 foo 함수가 호출되었기 때문에 전역 코드의 실행이 일시 중단되고 foo 함수 내부로 진입합니다.  
마찬가지로 자바스크립트 엔진은 foo 함수 내부의 함수 코드를 평가해, foo 함수 실행 컨텍스트를 생성하고 실행 컨텍스트 스택에 푸시합니다.  
그리고 foo 함수 내부의 지역 변수 b와 중첩함수 bar가 foo 함수 실행 컨텍스트에 등록됩니다.

![img-14](https://user-images.githubusercontent.com/81365896/128695130-0f8bfbe1-29a7-4fca-b95d-0f59507a85dd.png)

이후 foo 함수 코드가 실행되어 지역 변수 b에 값이 할당되고 중첩 함수 bar가 호출됩니다.

![img-15](https://user-images.githubusercontent.com/81365896/128695131-a6b83b37-2072-406a-abf4-3e4fa4601b17.png)

중첩 함수 bar가 호출되었기 때문에 foo 함수 코드의 실행이 일시 중단되고 bar 함수 내부로 진입합니다.  
자바스크립트 엔진은 bar 함수 내부의 코드를 평가해, bar 함수 실행 컨텍스트를 생성하고 실행 컨텍스트 스택에 푸시합니다.  
이 때 bar 함수의 지역 변수 c가 bar 함수 실행 컨텍스트에 등록됩니다.

![img-16](https://user-images.githubusercontent.com/81365896/128695137-cef37bdd-978e-4a12-98ec-d73f6940e592.png)

그리고 함수 코드를 실행해 지역 변수 c에 값이 할당되고 console.log 메서드가 호출된 후 bar 함수는 종료됩니다.  
bar 함수가 종료되면 bar 함수 실행 컨텍스트를 실행 컨텍스트 스택에서 제거합니다.  
그리고 foo 함수도 더 이상 실행할 코드가 없으므로 종료되어 스택에서 제거됩니다.  
마지막으로 더 이상 실행할 전역 코드가 남아 있지 않으므로 전역 실행 컨텍스트도 스택에서 제거됩니다.

![img-17](https://user-images.githubusercontent.com/81365896/128695151-582193ba-d287-4db1-91ed-eb7209adb5d8.png)

여기까지 실행 컨텍스트가 실행 순서를 관리하는 과정에 대한 설명이고, 다음엔 식별자를 어떻게 관리하는지 설명하겠습니다.  
식별자는 렉시컬 환경이라는 것을 통해 관리됩니다.

![img-18](https://user-images.githubusercontent.com/81365896/128695155-1dccff2f-1951-4d5a-901b-9a56c1bbf611.png)

렉시컬 환경은 앞에서 설명한 실행 컨텍스트를 구성하는 컴포넌트입니다.

![img-20](https://user-images.githubusercontent.com/81365896/128695161-4ed30f6b-d619-4ea8-9a4a-03a538a9b8f0.png)

그리고 이 렉시컬 환경은 다시 두 개의 컴포넌트로 나뉘는데,  
환경 레코드는 스코프에 포함된 식별자를 등록하고, 등록된 식별자에 바인딩된 값을 관리하는 저장소 역할을 합니다.  
외부 렉시컬 환경에 대한 참조는 상위 스코프를 참조하게 됩니다.

![img-21](https://user-images.githubusercontent.com/81365896/128695171-807501e1-eaf9-488a-8a12-f5a96569ddfa.png)

렉시컬 환경은 이렇게 키와 값을 갖는 객체 형태의 스코프를 생성해서 식별자를 키로 등록하고 식별자에 바인딩된 값을 관리합니다.  
자바스크립트에서 블록 레벨 스코프를 생성하는 것이 바로 렉시컬 환경입니다.

![img-22](https://user-images.githubusercontent.com/81365896/128695179-756b5c39-ecf5-4ed2-a452-1a72e23b0fb0.png)

이렇게 외부 렉시컬 환경에 대한 참조를 통해 상위 스코프인 전역 스코프를 참조하는 것을 스코프 체인이라고 합니다.

![img-04](https://user-images.githubusercontent.com/81365896/128695075-ba1cf914-d8c2-48b3-88e5-92d817b4dce5.png)

결론을 정리해보면 실행 컨텍스트는 실행 컨텍스트 스택과 렉시컬 환경을 통해서 코드의 실행 순서와 식별자를 관리합니다.  
이외에 실행 컨텍스트 자체를 어떻게 생성하는지의 세부 내용은 다음에 더 알아보겠습니다.
